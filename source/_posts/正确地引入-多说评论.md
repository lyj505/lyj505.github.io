1. ---
title: 正确地引入'多说评论'
date: 2016-05-18 20:10:50
tags: [hexo,多说]
categories: [配置hexo]

---

## 关于多说评论

### 首先看下官方文档
[next](http://theme-next.iissnan.com/third-party-services.html#duoshuo)

　　先申明一下，博主使用的是next主题 <#version: 5.0.1>，有可能按照这样配置可能会出问题。
    　　1.在多说官网中获取duoshuo_shortname，并将它配置到你的站点配置文件中。
    　　2.说一下遇到的问题，首先在[arao博主](http://www.arao.me/2015/hexo-next-theme-optimize-base/)的文章里看到关于“添加多说”，简单说下，他是将作用代码放到page.swig里，我按照这种方法放进去了，并没有成功。
    　　3.查询了下关于swig文件，最开始以为使用的是JSP语言的结果细看代码，比如：
    　　JSP指令标记中的include：
      ```cpp
<%@ include file="文件的名字" %>
      ```
　　这个标记的作用是在JSP页面出现该指令的位置处，静态插入一个文件。
　　而SWIG基于nodejs的模板引擎。
          <!-- more -->
  　　<h3>include</h3>
包含一个模板到当前位置，这个模板将使用当前上下文，基本参数：
      file 包含的这个模板的相对路径
      ignore missing  包含模板不存在也不会报错
      ```cpp
        {% include '_partials/head.swig' %}
      ```
  比如这个代码的意思就是在页面中引入一个swig文件，其实和JSP的意思是相同的，都相当于静态地插入一个文件。
  而这个代码中没含有ignore missing，意思就是当文件路径出错的时候，就会报错，之前我误删了swig就会出现这
  种现象。
　　　 我们来了解一下SWIG的基本用法：
     变量：
```
    {{ foo.bar }}
```
   模板继承：Swig 使用 extends 和 block 来实现模板继承
　　_layout.swig
```django
  <!doctype html>
  <html>
  <head>
  {% include '_partials/head.swig' %}
  <title>{% block title %}MY Blog{% endblock %}</title>
  </head>
  <body>{% block content %}{% endblock %}</body>
```
　　_tag.swig
```cpp
{% extends '_layout.swig' %}
{% import '_macro/post-collapse.swig' as post_template %}
```
　常见标签：if　接受任何有效的 JavaScript 条件语句
```cpp
{% if x %}{% endif %}
```
　　　　　　import 　允许引入另一个模板的宏进入当前上下文

```cpp
{% import '_macro/sidebar.swig' as sidebar_template %}
```

### 关于如何正确地调用代码

- 首先在next主题目录下进入layout,会发现2个comments.swig,一个是在/layout/third-party里的，然后在/layout/third-party里有一个comments的文件夹。
- 第二个comments.swig是在/layout/_partials里的，所以在这里说明了我不能使用arao的方法调用duoshuo的代码，
因为路径不对，打开layout.swig会发现comments.swig是第二个调用的路径即在/layout/_partials里
- [关于data-thread-key](http://dev.duoshuo.com/docs/5003ecd94cab3e7250000008)，之前我将此代码放在第一个即：/layout/third-party下的comments.swig里，能正确生成评论，但是在不同页面评论，会出现重复评论。之前我一直认为是我的代码出了问题，导致页面无法识别每个页面的data-thread-key，我有在每一个md中添加了<div class="ds-thread" data-thread-key="{{ page.path }}"，我手动添加了不同的data-thread-key，发现解决了重复评论的问题，但是出现了新的问题：即评论框的位置不是正确的位置。
- 其实总结一下就是应该在正确的位置添加正确的代码，以下是我在comment.swig里添加的代码：

```html
{% if page.comments %}
<div class="comments" id="comments">
  <div class="ds-thread" data-thread-key="{{ page.path }}"
           data-title="{{ page.title }}" data-url="{{ page.permalink }}"></div>
  <!-- 多说评论框 end -->
  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  <script type="text/javascript">
var duoshuoQuery = {short_name:"imgaylao"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.unstable.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
  <!-- 多说公共JS代码 end -->

</div>
{% endif %}

```

### 需要注意的几点

    1.short_name 要填写正确。
    2.从duoshuo网中提取的js代码要放在正确的位置。
    3.将{% if (theme.duoshuo and theme.duoshuo.shor
tname)or theme.duoshuo_shortname %}
    这个代码从comments.swig里删掉。






